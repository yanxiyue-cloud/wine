import * as d3 from "d3"

export function curHistory(data) {
    d3.select(".cur-history-svg").remove()
    let width = document.querySelector(".cur-history .chart").offsetWidth,
        height = document.querySelector(".cur-history .chart").offsetHeight
    let pathHeight = height / 5
    let svg = d3.select(".cur-history .chart")
        .append("svg")
        .attr("class", "cur-history-svg")
        .attr("width", width)
        .attr("height", pathHeight * data.history.length)
    if (data.history.length == 0) {
        svg.attr("height", height)
        svg.append("text")
            .attr("font-size", 30)
            .style("writing-mode", "vertical-lr")
            .attr("x", width / 2)
            .attr("y", height / 5)
            .text("暂未找到该酒厂历史信息")
        return
    }

    let link = svg.append("g")
    let time = svg.append("g")
    let text = svg.append("g")
    let path = svg.append("g")
    let circle = svg.append("g")
    let smallCircle = svg.append("g")
    path.selectAll("path")
        .data(data.history)
        .enter()
        .append("path")
        .attr("stroke-linecap", "round")
        .attr("stroke-width", 5)
        .attr("stroke-dasharray", "5 10")
        .attr("stroke", "rgb(209,209,217)")
        .attr("d", (d, i) => `M${width / 2},${pathHeight * i + 10} V${pathHeight * (i + 1) - 10}`)
    circle.selectAll("circle")
        .data(data.history)
        .enter()
        .append("circle")
        .attr("fill", "rgb(249,205,235)")
        .attr("stroke", "white")
        .attr("stroke-width", 5)
        .attr("cx", width / 2)
        .attr("cy", (d, i) => pathHeight * i + (pathHeight) / 2)
        .attr("r", 20)
    link.selectAll("path")
        .data(data.history)
        .enter()
        .append("path")
        .attr("stroke-linecap", "round")
        .attr("stroke-width", 3)
        .attr("fill", "none")
        .attr("stroke-dasharray", "5 10")
        .attr("stroke", "rgb(209,209,217)")
        .attr("d", (d, i) => `M${width / 2},${pathHeight * i + (pathHeight) / 2} H${width / 2 + (i % 2 ? -1 : 1) * width / 4} V${pathHeight * (i + 1) - pathHeight / 3}`)
    time.selectAll("text")
        .data(data.history)
        .enter()
        .append("text")
        .attr("font-size", 20)
        .attr("font-family", "KaiTi")
        .attr("font-weight", "bold")
        .attr("x", (d, i) => width / 2 - 20 + (i % 2 ? 1 : -1) * 50)
        .attr("y", (d, i) => pathHeight * i + (pathHeight) / 2 + 10)
        .text((d) => d.time)
    text.selectAll("text")
        .data(data.history)
        .enter()
        .append("text")
        .attr("font-size", 20)
        .attr("font-family", "KaiTi")
        .attr("font-weight", "bold")
        .attr("x", (d, i) => width / 2 + (i % 2 ? -1 : 1) * width / 4 - d.name.length * 20 / 2)
        .attr("y", (d, i) => pathHeight * (i + 1) - pathHeight / 3 + 30)
        .text((d) => d.name)
    smallCircle.selectAll("circle")
        .data(data.history)
        .enter()
        .append("circle")
        .attr("r", 7)
        .attr("stroke-width", 2)
        .attr("stroke", "rgb(255,255,255)")
        .attr("fill", "rgb(249,175,215)")
        .attr("cx", (d, i) => width / 2 + (i % 2 ? -1 : 1) * width / 4)
        .attr("cy", (d, i) => pathHeight * (i + 1) - pathHeight / 3)
}